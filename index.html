<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surat Pribadi Anda</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div id="app">
        <div id="login-section">
            <h1>Selamat Datang</h1>
            <p>Untuk membaca surat ini, silakan masukkan kata sandi.</p>
            <p class="warning-clue">
                Clue: kata sandi adalah satu teks kalimat surat fisik yang pernah terkirim. Baca kalimat terakhirnya. Satu kata di akhir itu adalah sandi untuk membuka file ini. (tanpa spasi, huruf kecil semua, satu kata saja)
            </p>
            <div class="password-input-container">
                <input type="password" id="password-input" placeholder="Kata Sandi Rahasia">
                <span class="password-toggle" onclick="togglePasswordVisibility()">
                    <i class="fas fa-eye" id="password-toggle-icon"></i>
                </span>
            </div>
            <button onclick="checkPassword()">Masuk</button>
            <p id="error-message" class="hidden">Kata sandi salah. Coba lagi!</p>
            </div>

        <div id="letter-section" class="hidden">
            <h1>Sebuah Pesan dari Hati</h1>
            <div class="letter-content">
                <p>Halo [Nama Penerima],</p>
                <p>Surat ini saya tulis khusus untukmu. Semoga kamu dalam keadaan baik dan pesan ini sampai dengan selamat.</p>
                <p>Sejak kita terakhir bertemu, banyak hal yang terjadi... [**TULIS ISI SURAT ANDA DI SINI**]. Ingatlah semua kenangan indah kita.</p>
                <p>Pesan ini dibuat dengan penuh perhatian dan kasih sayang. Hanya untuk matamu saja.</p>
                <p>Salam hangat selalu,</p>
                <p><span id="sender-name">[Nama Anda]</span></p>
                <p><em>Tanggal: 27 Juli 2025</em></p>
            </div>
            <button onclick="logout()">Keluar</button>
            <button onclick="showMessageForm()">Kirim Pesan</button>
            <audio id="background-music" loop>
                <source src="lagu_90an.mp3" type="audio/mpeg">
                Browser Anda tidak mendukung pemutar audio.
            </audio>
        </div>

        <div id="message-section" class="hidden">
            <h2>Kirim Pesan atau Komentar</h2>
            <p>Ada yang ingin Anda sampaikan? Kirim pesan langsung kepada saya.</p>
            <form action="https://formspree.io/f/yourformhash" method="POST" id="contact-form">
                <input type="email" name="email" placeholder="Email Anda (Opsional)">
                <textarea name="message" placeholder="Tulis pesan Anda di sini..." required></textarea>
                <button type="submit">Kirim Pesan</button>
                <p id="form-status" class="hidden"></p>
            </form>
            <button onclick="hideMessageForm()">Kembali ke Surat</button>
        </div>

        <div id="code-section" class="hidden">
            <h2>Isi Surat (Raw Text)</h2>
            <pre><code id="letter-code"></code></pre>
            <button onclick="hideCode()">Sembunyikan</button>
        </div>
    </div>

    <script>
        // *** KATA SANDI ANDA ADA DI SINI ***
        const CORRECT_PASSWORD = 'terasa'; 

        const passwordInput = document.getElementById('password-input');
        const errorMessage = document.getElementById('error-message');
        const loginSection = document.getElementById('login-section');
        const letterSection = document.getElementById('letter-section');
        const codeSection = document.getElementById('code-section');
        const letterCodeElement = document.getElementById('letter-code');
        const backgroundMusic = document.getElementById('background-music');
        const letterContentElement = document.querySelector('#letter-section .letter-content');
        const passwordToggleIcon = document.getElementById('password-toggle-icon');

        // Variabel baru untuk elemen form
        const messageSection = document.getElementById('message-section');
        const contactForm = document.getElementById('contact-form');
        const formStatus = document.getElementById('form-status');


        function checkPassword() {
            if (passwordInput.value === CORRECT_PASSWORD) {
                loginSection.classList.add('hidden');
                letterSection.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                passwordInput.value = ''; // Bersihkan input
                
                const playPromise = backgroundMusic.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        // Auto-play dimulai
                    }).catch(error => {
                        console.log("Auto-play diblokir. Silakan putar musik secara manual.");
                    });
                }

            } else {
                errorMessage.classList.remove('hidden');
                passwordInput.value = ''; // Bersihkan input
                passwordInput.focus(); // Fokuskan kembali ke input
                backgroundMusic.pause(); // Pastikan lagu berhenti jika ada kesalahan
                backgroundMusic.currentTime = 0; // Reset lagu
            }
        }

        function logout() {
            letterSection.classList.add('hidden');
            loginSection.classList.remove('hidden');
            passwordInput.focus(); // Fokuskan kembali ke input
            backgroundMusic.pause(); // Hentikan lagu saat logout
            backgroundMusic.currentTime = 0; // Reset lagu
        }

        function togglePasswordVisibility() {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordToggleIcon.classList.remove('fa-eye');
                passwordToggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                passwordToggleIcon.classList.remove('fa-eye-slash');
                passwordToggleIcon.classList.add('fa-eye');
            }
        }

        function showCode() {
            loginSection.classList.add('hidden');
            letterSection.classList.add('hidden');
            codeSection.classList.remove('hidden');
            backgroundMusic.pause(); // Hentikan musik saat menampilkan kode
            backgroundMusic.currentTime = 0; // Reset musik

            const letterParagraphs = Array.from(letterContentElement.querySelectorAll('p')).map(p => p.textContent).join('\n\n');
            letterCodeElement.textContent = letterParagraphs;
        }

        function hideCode() {
            codeSection.classList.add('hidden');
            loginSection.classList.remove('hidden');
            passwordInput.focus();
        }

        // Fungsi untuk menampilkan form pesan
        function showMessageForm() {
            letterSection.classList.add('hidden');
            messageSection.classList.remove('hidden');
        }

        // Fungsi untuk menyembunyikan form pesan dan kembali ke surat
        function hideMessageForm() {
            messageSection.classList.add('hidden');
            letterSection.classList.remove('hidden');
            formStatus.classList.add('hidden'); // Sembunyikan status
            contactForm.reset(); // Bersihkan formulir
        }

        // Tangani submit formulir menggunakan Formspree
        contactForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Mencegah reload halaman
            const form = event.target;
            const data = new FormData(form);
            
            try {
                const response = await fetch(form.action, {
                    method: form.method,
                    body: data,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    formStatus.textContent = "Pesan berhasil terkirim! Terima kasih.";
                    formStatus.style.color = 'green';
                    formStatus.classList.remove('hidden');
                    form.reset(); // Bersihkan formulir setelah sukses
                } else {
                    const responseData = await response.json();
                    if (responseData.errors) {
                        formStatus.textContent = responseData.errors.map(error => error.message).join(', ');
                    } else {
                        formStatus.textContent = "Oops! Ada masalah saat mengirim pesan Anda.";
                    }
                    formStatus.style.color = 'red';
                    formStatus.classList.remove('hidden');
                }
            } catch (error) {
                formStatus.textContent = "Terjadi kesalahan jaringan. Coba lagi nanti.";
                formStatus.style.color = 'red';
                formStatus.classList.remove('hidden');
            }
        });

        // Untuk mengizinkan menekan Enter pada input password
        passwordInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        });
    </script>
</body>
</html>
